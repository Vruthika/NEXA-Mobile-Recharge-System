<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>NEXA - Payment</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&amp;display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              primary: "#6D28D9", // Violet
              "background-light": "#F3F4F6", // Light Gray
              "background-dark": "#1F2937", // Dark Gray
              "card-light": "#FFFFFF",
              "card-dark": "#374151",
              "text-light": "#111827",
              "text-dark": "#F9FAFB",
              "accent-light": "#E9D5FF", // Light Lavender
              "accent-dark": "#4C1D95", // Darker Violet
              "border-light": "#E5E7EB",
              "border-dark": "#4B5563",
            },
            fontFamily: {
              display: ["Poppins", "sans-serif"],
            },
            borderRadius: {
              DEFAULT: "0.5rem",
              lg: "1rem",
              xl: "1.5rem",
            },
          },
        },
      };
    </script>
    <style>
      body {
        font-family: "Poppins", sans-serif;
      }

      .payment-method {
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .payment-method:hover {
        background-color: #f0f9ff;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .payment-method.selected {
        background-color: #e0f2fe;
        border-color: #6d28d9;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(109, 40, 217, 0.3);
      }

      .payment-form {
        display: none;
        animation: fadeIn 0.3s ease;
      }

      .payment-form.active {
        display: block;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Success Animation */
      .success-animation {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(255, 255, 255, 0.95);
        z-index: 2000;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        backdrop-filter: blur(10px);
      }

      .success-animation.active {
        display: flex;
      }

      .checkmark-circle {
        width: 150px;
        height: 150px;
        position: relative;
        display: inline-block;
        vertical-align: top;
      }

      .checkmark-circle .background {
        width: 150px;
        height: 150px;
        border-radius: 50%;
        background: #00c851;
        position: absolute;
        animation: scaleIn 0.3s ease;
      }

      .checkmark-circle .checkmark {
        border-radius: 5px;
      }

      .checkmark-circle .checkmark.draw:after {
        animation-delay: 300ms;
        animation-duration: 1s;
        animation-timing-function: ease;
        animation-name: checkmark;
        transform: scaleX(-1) rotate(135deg);
        animation-fill-mode: forwards;
      }

      .checkmark-circle .checkmark:after {
        opacity: 0;
        height: 75px;
        width: 37.5px;
        transform-origin: left top;
        border-right: 15px solid white;
        border-top: 15px solid white;
        content: "";
        left: 25px;
        top: 75px;
        position: absolute;
      }

      @keyframes scaleIn {
        from {
          transform: scale(0);
        }
        to {
          transform: scale(1);
        }
      }

      @keyframes checkmark {
        0% {
          height: 0;
          width: 0;
          opacity: 1;
        }
        20% {
          height: 0;
          width: 37.5px;
          opacity: 1;
        }
        40% {
          height: 75px;
          width: 37.5px;
          opacity: 1;
        }
        100% {
          height: 75px;
          width: 37.5px;
          opacity: 1;
        }
      }

      .success-text {
        opacity: 0;
        transform: translateY(20px);
        animation: fadeInUp 0.5s ease forwards 0.7s;
      }

      @keyframes fadeInUp {
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .card-hover {
        transition: all 0.3s ease;
      }
      .card-hover:hover {
        transform: translateY(-4px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
      }

      input:focus {
        border-color: #6d28d9;
        box-shadow: 0 0 0 3px rgba(109, 40, 217, 0.1);
      }

      select:focus {
        border-color: #6d28d9;
        box-shadow: 0 0 0 3px rgba(109, 40, 217, 0.1);
      }

      /* Remove scrollbars */
      html {
        overflow-y: hidden;
      }

      body {
        overflow-y: auto;
        height: 100vh;
      }

      .container {
        max-height: 100vh;
        overflow-y: auto;
      }

      /* Custom scrollbar for webkit browsers */
      .container::-webkit-scrollbar {
        width: 0px;
        background: transparent;
      }

      /* Modal styles */
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
      }

      .modal-overlay.active {
        opacity: 1;
        visibility: visible;
      }

      .modal-card {
        background: white;
        border-radius: 1rem;
        padding: 2rem;
        max-width: 90%;
        width: 400px;
        transform: translateY(-20px);
        transition: transform 0.3s ease;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1),
          0 10px 10px -5px rgba(0, 0, 0, 0.04);
      }

      .dark .modal-card {
        background: #374151;
        color: #f9fafb;
      }

      .modal-overlay.active .modal-card {
        transform: translateY(0);
      }

      .modal-icon {
        width: 4rem;
        height: 4rem;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 1rem;
        background-color: #fee2e2;
      }

      .dark .modal-icon {
        background-color: #7f1d1d;
      }

      .modal-icon .material-icons {
        font-size: 2rem;
        color: #dc2626;
      }

      .dark .modal-icon .material-icons {
        color: #fca5a5;
      }

      .modal-buttons {
        display: flex;
        gap: 0.75rem;
        margin-top: 1.5rem;
      }

      .modal-buttons button {
        flex: 1;
        padding: 0.75rem 1rem;
        border-radius: 0.5rem;
        font-weight: 600;
        transition: all 0.2s ease;
      }

      .btn-primary {
        background: linear-gradient(to right, #6d28d9, #7c3aed);
        color: white;
      }

      .btn-primary:hover {
        background: linear-gradient(to right, #5b21b6, #6d28d9);
        transform: translateY(-2px);
      }

      .btn-secondary {
        background: #e5e7eb;
        color: #374151;
      }

      .dark .btn-secondary {
        background: #4b5563;
        color: #e5e7eb;
      }

      .btn-secondary:hover {
        background: #d1d5db;
      }

      .dark .btn-secondary:hover {
        background: #6b7280;
      }
    </style>
  </head>
  <body
    class="min-h-screen bg-background-light dark:bg-background-dark text-text-light dark:text-text-dark overflow-x-hidden"
  >
    <!-- Login Required Modal -->
    <div id="login-modal" class="modal-overlay">
      <div class="modal-card">
        <div class="text-center">
          <div class="modal-icon">
            <span class="material-icons">lock</span>
          </div>
          <h2 class="text-2xl font-bold mb-2">Authentication Required</h2>
          <p class="text-gray-600 dark:text-gray-400 mb-4">
            You need to be logged in to complete this payment. Please login to
            continue.
          </p>

          <div class="modal-buttons">
            <button id="login-redirect-button" class="btn-primary">
              Login Now
            </button>
            <button id="cancel-modal-button" class="btn-secondary">
              Cancel
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Navbar -->
    <div id="navbar" class="bg-white dark:bg-gray-800 shadow-sm">
      <div
        class="container mx-auto px-4 py-4 flex justify-between items-center"
      >
        <div class="flex items-center">
          <div
            class="w-10 h-10 bg-gradient-to-r from-primary to-purple-500 rounded-lg flex items-center justify-center mr-3"
          >
            <span class="material-icons text-white">sim_card</span>
          </div>
          <span class="text-xl font-bold">NEXA</span>
        </div>
        <div class="flex items-center space-x-4">
          <button
            id="theme-toggle"
            class="p-2 rounded-full bg-gray-100 dark:bg-gray-700"
          >
            <span class="material-icons text-gray-600 dark:text-gray-300"
              >dark_mode</span
            >
          </button>
          <div class="flex items-center space-x-2">
            <div
              class="w-8 h-8 bg-primary rounded-full flex items-center justify-center"
            >
              <span class="material-icons text-white text-sm">person</span>
            </div>
            <span id="user-name" class="font-medium">Guest</span>
          </div>
        </div>
      </div>
    </div>

    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <main>
        <div class="text-center mb-8">
          <h1 class="text-3xl sm:text-4xl font-bold mb-2">
            Complete Your Payment
          </h1>
          <p class="text-gray-600 dark:text-gray-400">
            Secure and fast payment processing
          </p>
        </div>

        <div class="flex flex-col lg:flex-row gap-8 max-w-7xl mx-auto">
          <!-- Order Summary - Left Side -->
          <div class="w-full lg:w-1/3">
            <div
              class="bg-card-light dark:bg-card-dark rounded-2xl p-8 border border-border-light dark:border-border-dark card-hover sticky top-8"
            >
              <div class="text-center mb-6">
                <div
                  class="w-16 h-16 bg-gradient-to-r from-primary to-purple-500 rounded-2xl flex items-center justify-center mx-auto mb-4"
                >
                  <span class="material-icons text-white text-2xl"
                    >sim_card</span
                  >
                </div>
                <h2 class="text-2xl font-bold mb-2">Order Summary</h2>
              </div>

              <div class="space-y-4 mb-6">
                <div
                  class="flex justify-between items-center py-3 border-b border-border-light dark:border-border-dark"
                >
                  <span class="text-gray-600 dark:text-gray-400 font-medium"
                    >Plan:</span
                  >
                  <span class="font-semibold" id="plan-name"
                    >Premium Monthly</span
                  >
                </div>
                <div
                  class="flex justify-between items-center py-3 border-b border-border-light dark:border-border-dark"
                >
                  <span class="text-gray-600 dark:text-gray-400 font-medium"
                    >Category:</span
                  >
                  <span class="font-semibold" id="plan-category"
                    >Popular Plans</span
                  >
                </div>
                <div
                  class="flex justify-between items-center py-3 border-b border-border-light dark:border-border-dark"
                >
                  <span class="text-gray-600 dark:text-gray-400 font-medium"
                    >Validity:</span
                  >
                  <span class="font-semibold" id="plan-validity">28 days</span>
                </div>
                <div
                  class="flex justify-between items-center py-3 border-b border-border-light dark:border-border-dark"
                >
                  <span class="text-gray-600 dark:text-gray-400 font-medium"
                    >Amount:</span
                  >
                  <span class="font-semibold" id="plan-amount">₹499</span>
                </div>
                <div
                  class="flex justify-between items-center py-4 bg-accent-light dark:bg-accent-dark rounded-xl px-4"
                >
                  <span class="font-bold text-lg">Total:</span>
                  <span
                    class="font-bold text-2xl text-primary"
                    id="total-amount"
                    >₹499</span
                  >
                </div>
              </div>

              <div
                class="p-4 bg-green-50 dark:bg-green-900/20 rounded-xl border border-green-200 dark:border-green-800"
              >
                <div
                  class="flex items-center text-green-700 dark:text-green-300"
                >
                  <span class="material-icons mr-2 text-sm">security</span>
                  <span class="text-sm font-semibold">100% Secure Payment</span>
                </div>
                <p class="text-xs text-green-600 dark:text-green-400 mt-1">
                  Your payment information is encrypted and secure
                </p>
              </div>
            </div>
          </div>

          <!-- Payment Methods - Right Side -->
          <div class="w-full lg:w-2/3">
            <div
              class="bg-card-light dark:bg-card-dark rounded-2xl border border-border-light dark:border-border-dark overflow-hidden card-hover"
            >
              <div
                class="bg-gradient-to-r from-primary to-purple-600 text-white py-6 px-8"
              >
                <h2 class="text-2xl font-bold flex items-center">
                  <span class="material-icons mr-3 text-3xl">payment</span>
                  Select Payment Method
                </h2>
                <p class="text-purple-100 mt-2">
                  Choose your preferred payment option
                </p>
              </div>

              <div class="p-8">
                <!-- Payment Methods Grid -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                  <div
                    id="debit-card-option"
                    class="payment-method border-2 border-border-light dark:border-border-dark rounded-xl p-6 text-center"
                  >
                    <div
                      class="bg-blue-100 dark:bg-blue-900/30 rounded-2xl p-4 inline-block mb-4"
                    >
                      <span
                        class="material-icons text-blue-600 dark:text-blue-400 text-3xl"
                        >credit_card</span
                      >
                    </div>
                    <h3 class="font-semibold text-lg mb-2">Debit Card</h3>
                    <p class="text-sm text-gray-600 dark:text-gray-400">
                      Pay securely using your debit card
                    </p>
                  </div>

                  <div
                    id="credit-card-option"
                    class="payment-method border-2 border-border-light dark:border-border-dark rounded-xl p-6 text-center"
                  >
                    <div
                      class="bg-purple-100 dark:bg-purple-900/30 rounded-2xl p-4 inline-block mb-4"
                    >
                      <span
                        class="material-icons text-purple-600 dark:text-purple-400 text-3xl"
                        >credit_card</span
                      >
                    </div>
                    <h3 class="font-semibold text-lg mb-2">Credit Card</h3>
                    <p class="text-sm text-gray-600 dark:text-gray-400">
                      Pay using Visa, Mastercard, or RuPay
                    </p>
                  </div>

                  <div
                    id="net-banking-option"
                    class="payment-method border-2 border-border-light dark:border-border-dark rounded-xl p-6 text-center"
                  >
                    <div
                      class="bg-green-100 dark:bg-green-900/30 rounded-2xl p-4 inline-block mb-4"
                    >
                      <span
                        class="material-icons text-green-600 dark:text-green-400 text-3xl"
                        >account_balance</span
                      >
                    </div>
                    <h3 class="font-semibold text-lg mb-2">Net Banking</h3>
                    <p class="text-sm text-gray-600 dark:text-gray-400">
                      Pay directly from your bank account
                    </p>
                  </div>
                </div>

                <!-- Card Payment Form -->
                <div id="card-payment-form" class="payment-form">
                  <div class="bg-gray-50 dark:bg-gray-800/30 rounded-2xl p-8">
                    <h3 class="font-bold text-xl mb-6 flex items-center">
                      <span class="material-icons mr-3 text-primary"
                        >credit_card</span
                      >
                      Enter Card Details
                    </h3>
                    <form id="card-form" class="space-y-6">
                      <div>
                        <label
                          class="block text-sm font-semibold mb-2"
                          for="card-number"
                          >Card Number</label
                        >
                        <input
                          class="w-full px-4 py-3 border-2 border-border-light dark:border-border-dark rounded-xl bg-card-light dark:bg-card-dark focus:outline-none transition-all duration-200"
                          id="card-number"
                          type="text"
                          placeholder="1234 5678 9012 3456"
                          maxlength="19"
                        />
                      </div>

                      <div>
                        <label
                          class="block text-sm font-semibold mb-2"
                          for="card-name"
                          >Name on Card</label
                        >
                        <input
                          class="w-full px-4 py-3 border-2 border-border-light dark:border-border-dark rounded-xl bg-card-light dark:bg-card-dark focus:outline-none transition-all duration-200"
                          id="card-name"
                          type="text"
                          placeholder="John Doe"
                        />
                      </div>

                      <div class="grid grid-cols-2 gap-4">
                        <div>
                          <label
                            class="block text-sm font-semibold mb-2"
                            for="expiry-date"
                            >Expiry Date</label
                          >
                          <input
                            class="w-full px-4 py-3 border-2 border-border-light dark:border-border-dark rounded-xl bg-card-light dark:bg-card-dark focus:outline-none transition-all duration-200"
                            id="expiry-date"
                            type="text"
                            placeholder="MM/YY"
                            maxlength="5"
                          />
                        </div>
                        <div>
                          <label
                            class="block text-sm font-semibold mb-2"
                            for="cvv"
                            >CVV</label
                          >
                          <input
                            class="w-full px-4 py-3 border-2 border-border-light dark:border-border-dark rounded-xl bg-card-light dark:bg-card-dark focus:outline-none transition-all duration-200"
                            id="cvv"
                            type="password"
                            placeholder="123"
                            maxlength="3"
                          />
                        </div>
                      </div>

                      <button
                        id="pay-card-button"
                        class="w-full bg-gradient-to-r from-primary to-purple-600 hover:from-purple-700 hover:to-purple-800 text-white font-bold py-4 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 flex items-center justify-center text-lg"
                        type="button"
                      >
                        <span class="material-icons mr-2">lock</span>
                        <p>
                          Pay <span id="card-pay-amount">₹499</span> Securely
                        </p>
                      </button>
                    </form>
                  </div>
                </div>

                <!-- Net Banking Form -->
                <div id="net-banking-form" class="payment-form">
                  <div class="bg-gray-50 dark:bg-gray-800/30 rounded-2xl p-8">
                    <h3 class="font-bold text-xl mb-6 flex items-center">
                      <span class="material-icons mr-3 text-primary"
                        >account_balance</span
                      >
                      Net Banking Details
                    </h3>
                    <form id="net-banking-form-element" class="space-y-6">
                      <div>
                        <label
                          class="block text-sm font-semibold mb-2"
                          for="bank-select"
                          >Select Your Bank</label
                        >
                        <select
                          class="w-full px-4 py-3 border-2 border-border-light dark:border-border-dark rounded-xl bg-card-light dark:bg-card-dark focus:outline-none transition-all duration-200"
                          id="bank-select"
                        >
                          <option value="">Choose your bank</option>
                          <option value="sbi">State Bank of India</option>
                          <option value="hdfc">HDFC Bank</option>
                          <option value="icici">ICICI Bank</option>
                          <option value="axis">Axis Bank</option>
                          <option value="kotak">Kotak Mahindra Bank</option>
                        </select>
                      </div>

                      <div>
                        <label
                          class="block text-sm font-semibold mb-2"
                          for="account-number"
                          >Account Number</label
                        >
                        <input
                          class="w-full px-4 py-3 border-2 border-border-light dark:border-border-dark rounded-xl bg-card-light dark:bg-card-dark focus:outline-none transition-all duration-200"
                          id="account-number"
                          type="text"
                          placeholder="Enter your account number"
                        />
                      </div>

                      <div>
                        <label
                          class="block text-sm font-semibold mb-2"
                          for="ifsc-code"
                          >IFSC Code</label
                        >
                        <input
                          class="w-full px-4 py-3 border-2 border-border-light dark:border-border-dark rounded-xl bg-card-light dark:bg-card-dark focus:outline-none transition-all duration-200"
                          id="ifsc-code"
                          type="text"
                          placeholder="Enter IFSC code"
                        />
                      </div>

                      <button
                        id="pay-netbanking-button"
                        class="w-full bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white font-bold py-4 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 flex items-center justify-center text-lg"
                        type="button"
                      >
                        <span class="material-icons mr-2">lock</span>
                        <p>
                          Pay
                          <span id="netbanking-pay-amount">₹499</span> Securely
                        </p>
                      </button>
                    </form>
                  </div>
                </div>

                <!-- Instructions when no payment method selected -->
                <div id="select-method-instruction" class="text-center py-12">
                  <div class="text-gray-400 dark:text-gray-600 mb-4">
                    <span class="material-icons text-6xl">touch_app</span>
                  </div>
                  <h3 class="text-xl font-semibold mb-2">
                    Select a Payment Method
                  </h3>
                  <p class="text-gray-600 dark:text-gray-400">
                    Choose from the options above to proceed with your payment
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- Success Animation -->
    <div id="success-animation" class="success-animation">
      <div class="checkmark-circle">
        <div class="background"></div>
        <div class="checkmark draw"></div>
      </div>
      <h2 class="text-4xl font-bold mt-6 success-text">Payment Successful!</h2>
      <p class="text-gray-600 dark:text-gray-400 mt-2 success-text text-lg">
        Your transaction has been completed successfully.
      </p>
      <button
        id="continue-button"
        class="mt-8 bg-gradient-to-r from-primary to-purple-600 hover:from-purple-700 hover:to-purple-800 text-white font-bold py-3 px-8 rounded-xl transition-all duration-200 success-text transform hover:scale-105"
      >
        Continue to Dashboard
      </button>
    </div>

    <!-- Footer -->
    <div
      id="footer"
      class="bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 mt-12"
    >
      <div class="container mx-auto px-4 py-8">
        <div class="flex flex-col md:flex-row justify-between items-center">
          <div class="flex items-center mb-4 md:mb-0">
            <div
              class="w-8 h-8 bg-gradient-to-r from-primary to-purple-500 rounded-lg flex items-center justify-center mr-2"
            >
              <span class="material-icons text-white text-sm">sim_card</span>
            </div>
            <span class="text-lg font-bold">NEXA</span>
          </div>
          <div class="text-gray-600 dark:text-gray-400 text-sm">
            © 2023 NEXA. All rights reserved.
          </div>
        </div>
      </div>
    </div>

    <script>
      // Global variables
      let selectedPlan = null;
      let planData = {};

      // Function to check if user is logged in with modal
      function checkUserAuthentication() {
        const loggedInUser = localStorage.getItem("loggedInUser");
        if (!loggedInUser) {
          showLoginModal();
          return null;
        }
        return JSON.parse(loggedInUser);
      }

      // Function to show login modal
      function showLoginModal() {
        const modal = document.getElementById("login-modal");
        modal.classList.add("active");
      }

      // Function to hide login modal
      function hideLoginModal() {
        const modal = document.getElementById("login-modal");
        modal.classList.remove("active");
      }

      // Function to get URL parameters
      function getUrlParameter(name) {
        name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
        var regex = new RegExp("[\\?&]" + name + "=([^&#]*)");
        var results = regex.exec(location.search);
        return results === null
          ? ""
          : decodeURIComponent(results[1].replace(/\+/g, " "));
      }

      // Function to format date as YYYY-MM-DD
      function formatDate(date) {
        const d = new Date(date);
        const year = d.getFullYear();
        const month = String(d.getMonth() + 1).padStart(2, "0");
        const day = String(d.getDate()).padStart(2, "0");
        return `${year}-${month}-${day}`;
      }

      // Function to update plan details in UI
      function updatePlanDetails(plan) {
        const planName = document.getElementById("plan-name");
        const planCategory = document.getElementById("plan-category");
        const planValidity = document.getElementById("plan-validity");
        const planAmount = document.getElementById("plan-amount");
        const totalAmount = document.getElementById("total-amount");
        const cardPayAmount = document.getElementById("card-pay-amount");
        const netbankingPayAmount = document.getElementById(
          "netbanking-pay-amount"
        );

        const formattedPrice = `₹${plan.price || "499"}`;

        planName.textContent = plan.name || "Premium Monthly";
        planCategory.textContent = plan.category || "Popular Plans";
        planValidity.textContent = plan.validity || "28 days";
        planAmount.textContent = formattedPrice;
        totalAmount.textContent = formattedPrice;
        cardPayAmount.textContent = formattedPrice;
        netbankingPayAmount.textContent = formattedPrice;

        planData = plan;
      }

      // Payment functionality
      document.addEventListener("DOMContentLoaded", function () {
        console.log("DOM loaded, initializing payment page...");

        // Check if user is logged in
        const loggedInUser = checkUserAuthentication();
        if (loggedInUser) {
          // Update user name in navbar
          document.getElementById("user-name").textContent =
            loggedInUser.name || "User";
        }

        // Modal elements
        const loginModal = document.getElementById("login-modal");
        const loginRedirectButton = document.getElementById(
          "login-redirect-button"
        );
        const cancelModalButton = document.getElementById(
          "cancel-modal-button"
        );

        // Login redirect button
        loginRedirectButton.addEventListener("click", function () {
          // Store the current payment page URL to redirect back after login
          const currentUrl = window.location.href;
          localStorage.setItem("redirectAfterLogin", currentUrl);
          // Redirect to login page
          window.location.href = "/pages/auth/login/login.html";
        });

        // Cancel button
        cancelModalButton.addEventListener("click", function () {
          hideLoginModal();
          // Redirect to plans page
          window.location.href = "/pages/plans/plans.html";
        });

        // Close modal when clicking outside
        loginModal.addEventListener("click", function (e) {
          if (e.target === loginModal) {
            hideLoginModal();
            // Redirect to plans page
            window.location.href = "/pages/plans/plans.html";
          }
        });

        // Theme toggle functionality
        document
          .getElementById("theme-toggle")
          .addEventListener("click", function () {
            if (document.documentElement.classList.contains("dark")) {
              document.documentElement.classList.remove("dark");
              localStorage.setItem("theme", "light");
            } else {
              document.documentElement.classList.add("dark");
              localStorage.setItem("theme", "dark");
            }
          });

        // Check for saved theme preference
        if (localStorage.getItem("theme") === "dark") {
          document.documentElement.classList.add("dark");
        }

        // Payment method elements
        const debitCardOption = document.getElementById("debit-card-option");
        const creditCardOption = document.getElementById("credit-card-option");
        const netBankingOption = document.getElementById("net-banking-option");
        const cardPaymentForm = document.getElementById("card-payment-form");
        const netBankingForm = document.getElementById("net-banking-form");
        const selectMethodInstruction = document.getElementById(
          "select-method-instruction"
        );
        const payCardButton = document.getElementById("pay-card-button");
        const payNetbankingButton = document.getElementById(
          "pay-netbanking-button"
        );
        const successAnimation = document.getElementById("success-animation");
        const continueButton = document.getElementById("continue-button");

        // Payment method selection
        debitCardOption.addEventListener("click", function () {
          if (!loggedInUser) {
            showLoginModal();
            return;
          }
          selectPaymentMethod(debitCardOption);
          showForm(cardPaymentForm);
        });

        creditCardOption.addEventListener("click", function () {
          if (!loggedInUser) {
            showLoginModal();
            return;
          }
          selectPaymentMethod(creditCardOption);
          showForm(cardPaymentForm);
        });

        netBankingOption.addEventListener("click", function () {
          if (!loggedInUser) {
            showLoginModal();
            return;
          }
          selectPaymentMethod(netBankingOption);
          showForm(netBankingForm);
        });

        // Process card payment
        payCardButton.addEventListener("click", function () {
          if (!loggedInUser) {
            showLoginModal();
            return;
          }

          const cardNumber = document.getElementById("card-number").value;
          const cardName = document.getElementById("card-name").value;
          const expiryDate = document.getElementById("expiry-date").value;
          const cvv = document.getElementById("cvv").value;

          if (validateCardDetails(cardNumber, cardName, expiryDate, cvv)) {
            processPayment(payCardButton);
          }
        });

        // Process net banking payment
        payNetbankingButton.addEventListener("click", function () {
          if (!loggedInUser) {
            showLoginModal();
            return;
          }

          const bank = document.getElementById("bank-select").value;
          const accountNumber = document.getElementById("account-number").value;
          const ifscCode = document.getElementById("ifsc-code").value;

          if (validateNetBankingDetails(bank, accountNumber, ifscCode)) {
            processPayment(payNetbankingButton);
          }
        });

        // Continue after successful payment
        continueButton.addEventListener("click", function () {
          window.location.href = "/pages/customer/dashboard/dashboard.html";
        });

        // Helper functions
        function selectPaymentMethod(selected) {
          const paymentMethods = document.querySelectorAll(".payment-method");
          paymentMethods.forEach((method) => {
            method.classList.remove("selected");
          });
          selected.classList.add("selected");
        }

        function showForm(formToShow) {
          // Hide all forms and instruction
          cardPaymentForm.classList.remove("active");
          netBankingForm.classList.remove("active");
          selectMethodInstruction.style.display = "none";

          // Show selected form
          formToShow.classList.add("active");
        }

        function validateCardDetails(cardNumber, cardName, expiryDate, cvv) {
          if (!cardNumber || cardNumber.replace(/\s/g, "").length !== 16) {
            alert("Please enter a valid 16-digit card number");
            return false;
          }

          if (!cardName || cardName.trim().length < 2) {
            alert("Please enter the name on your card");
            return false;
          }

          if (
            !expiryDate ||
            !expiryDate.match(/^(0[1-9]|1[0-2])\/([0-9]{2})$/)
          ) {
            alert("Please enter a valid expiry date (MM/YY)");
            return false;
          }

          if (!cvv || cvv.length !== 3) {
            alert("Please enter a valid 3-digit CVV");
            return false;
          }

          return true;
        }

        function validateNetBankingDetails(bank, accountNumber, ifscCode) {
          if (!bank) {
            alert("Please select your bank");
            return false;
          }

          if (!accountNumber || accountNumber.length < 8) {
            alert("Please enter a valid account number");
            return false;
          }

          if (!ifscCode || ifscCode.length < 8) {
            alert("Please enter a valid IFSC code");
            return false;
          }

          return true;
        }

        function processPayment(button) {
          // Show loading state
          const originalHTML = button.innerHTML;
          button.innerHTML =
            '<span class="material-icons animate-spin mr-2">hourglass_empty</span>Processing...';
          button.disabled = true;

          // Simulate payment processing
          setTimeout(function () {
            // Show success animation
            successAnimation.classList.add("active");

            // Reset button state
            button.innerHTML = originalHTML;
            button.disabled = false;
          }, 2500);
        }

        // Format card number with spaces
        const cardNumberInput = document.getElementById("card-number");
        if (cardNumberInput) {
          cardNumberInput.addEventListener("input", function (e) {
            let value = e.target.value
              .replace(/\s+/g, "")
              .replace(/[^0-9]/gi, "");
            if (value.length > 0) {
              value = value.match(new RegExp(".{1,4}", "g")).join(" ");
            }
            e.target.value = value.substring(0, 19);
          });
        }

        // Format expiry date
        const expiryDateInput = document.getElementById("expiry-date");
        if (expiryDateInput) {
          expiryDateInput.addEventListener("input", function (e) {
            let value = e.target.value.replace(/\D/g, "");
            if (value.length > 2) {
              value = value.substring(0, 2) + "/" + value.substring(2, 4);
            }
            e.target.value = value;
          });
        }

        // Only allow numbers for CVV
        const cvvInput = document.getElementById("cvv");
        if (cvvInput) {
          cvvInput.addEventListener("input", function (e) {
            e.target.value = e.target.value.replace(/[^0-9]/g, "");
          });
        }
      });
    </script>
  </body>
</html>
